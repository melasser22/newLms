server:
  port: ${SERVER_PORT:8000}
  shutdown: graceful

spring:
  config:
    import:
      - "optional:configserver:${spring.cloud.config.uri:${SPRING_CLOUD_CONFIG_URI:http://config-server:8888}}"
      - "classpath:gateway.yml"
      - "classpath:routes.yml"
      - "classpath:security.yml"
      - "classpath:tenant.yml"
      - "classpath:resilience.yml"
      - "classpath:logging.yml"
  application:
    name: api-gateway
    admin:
      enabled: true
  main:
    lazy-initialization: true
    web-application-type: reactive
  output:
    ansi:
      enabled: ALWAYS
  boot:
    startup: info
  data:
    redis:
      repositories:
        enabled: false
  autoconfigure:
    exclude:
      - com.ejada.shared_starter_ratelimit.RateLimitAutoConfiguration
  kafka:
    listener:
      concurrency: 2
      auto-startup: false
  cloud:
    config:
      enabled: ${SPRING_CLOUD_CONFIG_ENABLED:true}
      uri: ${SPRING_CLOUD_CONFIG_URI:http://config-server:8888}
      profile: ${SPRING_CLOUD_CONFIG_PROFILE:${SPRING_PROFILES_ACTIVE:local}}
      label: ${SPRING_CLOUD_CONFIG_LABEL:main}
      username: ${SPRING_CLOUD_CONFIG_USERNAME:}
      password: ${SPRING_CLOUD_CONFIG_PASSWORD:}
      fail-fast: ${SPRING_CLOUD_CONFIG_FAIL_FAST:false}
  r2dbc:
    url: ${SPRING_R2DBC_URL:${GATEWAY_R2DBC_URL:r2dbc:postgresql://postgres:5432/lms}}
    username: ${SPRING_R2DBC_USERNAME:${GATEWAY_R2DBC_USERNAME:postgres}}
    password: ${SPRING_R2DBC_PASSWORD:${GATEWAY_R2DBC_PASSWORD:postgres}}
  sql:
    init:
      mode: ${SPRING_SQL_INIT_MODE:always}
      schema-locations: classpath:schema.sql
    compatibility-verifier:
      enabled: false

shared:
  patterns:
    docs:
      api-v3-single: &pattern-docs-api-v3-single /api/*/v3/api-docs/**
      api-v3-double: &pattern-docs-api-v3-double /api/*/*/v3/api-docs/**
      api-swagger-single: &pattern-docs-api-swagger-single /api/*/swagger-ui/**
      api-swagger-double: &pattern-docs-api-swagger-double /api/*/*/swagger-ui/**
      api-swagger-html-single: &pattern-docs-api-swagger-html-single /api/*/swagger-ui.html
      api-swagger-html-double: &pattern-docs-api-swagger-html-double /api/*/*/swagger-ui.html
      root-v3: &pattern-docs-root-v3 /v3/api-docs/**
      root-swagger: &pattern-docs-root-swagger /swagger-ui/**
      root-swagger-html: &pattern-docs-root-swagger-html /swagger-ui.html
    actuator:
      health: &pattern-actuator-health /actuator/health/**
      info: &pattern-actuator-info /actuator/info
      prometheus: &pattern-actuator-prometheus /actuator/prometheus
      generic: &pattern-actuator-generic /actuator/**
    auth:
      login: &pattern-auth-login /auth/admin/login
      api-auth: &pattern-auth-api /api/auth/**
      api-auth-superadmin: &pattern-auth-api-superadmin /api/auth/superadmin/**
      api-auth-v1: &pattern-auth-api-v1 /api/v1/auth/**
      api-auth-sec: &pattern-auth-sec /api/auth/**
      api-v1-superadmin: &pattern-auth-api-v1-superadmin /api/v1/superadmin/**
      api-sec-superadmin: &pattern-auth-sec-superadmin /api/v1/superadmin/**
      auth-admin: &pattern-auth-admin /api/auth/admin/login
      auth-sec-admin: &pattern-auth-sec-admin /api/auth/admin/login
      auth-root: &pattern-auth-root /auth/**
    misc:
      favicon: &pattern-misc-favicon /favicon.ico
      fallback: &pattern-fallback /fallback/**
      auth-root-sec: &pattern-auth-root-sec /api/v1/auth/**

app:
  env: ${APP_ENV:${SPRING_PROFILES_ACTIVE:local}}
  version: ${APP_VERSION:1.0.0}
  configuration-version: ${APP_CONFIGURATION_VERSION:${app.configuration-version:1}}

jasypt:
  encryptor:
    password: ${JASYPT_ENCRYPTOR_PASSWORD}
    algorithm: PBEWITHHMACSHA512ANDAES_256
    key-obtention-iterations: 1000
    pool-size: 1
    provider-name: SunJCE
    salt-generator-classname: org.jasypt.salt.RandomSaltGenerator
    iv-generator-classname: org.jasypt.iv.RandomIvGenerator
    string-output-type: base64
    fail-on-missing-password: ${JASYPT_ENCRYPTOR_FAIL_ON_MISSING_PASSWORD:true}
    property:
      prefix: ENC(
      suffix: )
